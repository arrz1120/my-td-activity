(function(e,b,d){var a=e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.msRequestAnimationFrame||e.osRequestAnimationFrame||e.requestAnimationFrame||function(g){return e.setTimeout(g,1000/60)};var c=(function(){var i={};var j=b.createElement("div").style;var g=(function(){var o=["t","webkitT","MozT","msT","OT"],m,n=0,k=o.length;for(;n<k;n++){m=o[n]+"ransform";if(m in j){return o[n].substr(0,o[n].length-1)}}return false})();function h(k){if(g===false){return false}if(g===""){return k}return g+k.charAt(0).toUpperCase()+k.substr(1)}i.extend=function(m,l){for(var k in l){m[k]=l[k]}};i.extend(i.style={},{transition:h("transition"),transform:h("transform"),transitionTimingFunction:h("transitionTimingFunction"),transitionDuration:h("transitionDuration"),transitionDelay:h("transitionDelay"),transformOrigin:h("transformOrigin"),touchAction:h("touchAction")});return i})();var f=function(h,g){this.STATE_DEFAULT=1,this.STATE_LEFT_SIDE=2,this.STATE_RIGHT_SIDE=3;this.slideBar=typeof h=="string"?b.querySelector(h):h;this.mask=this.slideBar.children[0];this.nav=this.slideBar.children[1];this.close=this.slideBar.querySelector(".back");this.isInTransition=false;this.initialTouchesPos=null;this.lastTouchesPos=null;this.moveTouchesPos=null;this.currentXPisition=0;this.currentState=this.STATE_DEFAULT;this.handleSize=10;this.itemWidth=this.nav.clientWidth;this.slopValue=this.itemWidth*(1/3);this._init()};f.prototype={update:function(){this.itemWidth=this.nav.clientWidth;this.slopValue=this.itemWidth*(1/3)},handleTouchStart:function(g){this.slideBar.addEventListener("touchmove",this,true);this.slideBar.addEventListener("touchend",this,true);this.slideBar.addEventListener("touchcancel",this,true);this.initialTouchesPos=this.getGesturePointFromEvent(g);this.nav.style[c.style.transition]="initial";this.mask.style[c.style.transition]="initial"},handleTouchMove:function(g){g.preventDefault();this.moveTouchesPos=this.getGesturePointFromEvent(g);var h=this.onFrameMove();a(h)},handleTouchEnd:function(g){this.lastTouchesPos=this.getGesturePointFromEvent(g);this.slideBar.removeEventListener("touchmove",this,true);this.slideBar.removeEventListener("touchend",this,true);this.slideBar.removeEventListener("touchcancel",this,true);this.updatePosition()},getGesturePointFromEvent:function(h){var g={};if(h.targetTouches){g.x=h.changedTouches[0].clientX;g.y=h.changedTouches[0].clientY}else{g.x=h.clientX;g.y=h.clientY}return g},updatePosition:function(){var h=this.lastTouchesPos.x-this.initialTouchesPos.x;this.currentXPisition=this.currentXPisition+h;var i=c.style.transition;var g=c.style.transform;if(d.abs(h)==0){return}if(this.currentState===this.STATE_DEFAULT){if(h<0&&d.abs(h)>this.slopValue){this.nav.style[g]="translateX(-100%) translateZ(1px)";this.nav.style[i]="all 150ms ease-out";this.currentState=this.STATE_LEFT_SIDE;this.currentXPisition=-this.itemWidth;this.mask.style.opacity=0.8}else{this.nav.style[g]="translateX(0) translateZ(1px)";this.nav.style[i]="all 150ms ease-out";this.currentXPisition=0;this.mask.style.opacity=0}}else{if(h>0&&d.abs(h)>this.slopValue){this.nav.style[g]="translateX(0) translateZ(1px)";this.nav.style[i]="all 150ms ease-out";this.currentXPisition=0;this.currentState=this.STATE_DEFAULT;this.mask.style.opacity=0}else{this.nav.style[g]="translateX(-100%) translateZ(1px)";this.nav.style[i]="all 150ms ease-out";this.currentXPisition=-this.itemWidth;this.mask.style.opacity=0.8}}this.isInTransition=true},onFrameMove:function(){var g=this;var h=c.style.transform;return function(){if(g.isInTransition){return}var l=g.moveTouchesPos.x-g.initialTouchesPos.x;var k=g.currentXPisition+l;var i=(g.itemWidth-d.abs(l))/g.itemWidth*0.8;if(k<-g.itemWidth){k=-g.itemWidth;i=0.8}if(k>0){k=0;i=0}g.mask.style.opacity=i;var j="translateX("+k+"px) translateZ(1px)";g.nav.style[h]=j}},_init:function(){this._initEvents()},show:function(){var g=c.style.transform,h=c.style.transitionDuration,i=c.style.transition;this.slideBar.style.visibility="visible";this.update();this.nav.style[g]="translate(-100%)";this.nav.style[i]="all 150ms ease-out";this.currentXPisition=-this.itemWidth;this.isInTransition=true;this.currentState=this.STATE_LEFT_SIDE;this.mask.style.opacity="0.8";this.mask.style[i]="all 150ms ease-out"},_close:function(i){var g=c.style.transform,h=c.style.transitionDuration,j=c.style.transition;this.nav.style[g]="translate(0)";this.nav.style[j]="all 150ms ease-out";this.currentXPisition=0;this.isInTransition=true;this.mask.style.opacity="0"},_hide:function(g){if(this.currentXPisition==0){this.slideBar.style.visibility="hidden"}},_initEvents:function(){this.mask.addEventListener("click",this,false);this.close.addEventListener("click",this,false);this.slideBar.addEventListener("touchstart",this,false);this.nav.addEventListener("webkitTransitionEnd",this,false);this.nav.addEventListener("transitionend",this,false)},handleEvent:function(g){switch(g.type){case"click":this._close(g);break;case"transitionend":case"webkitTransitionEnd":this.isInTransition=false;
this._hide(g);break;case"touchstart":this.handleTouchStart(g);break;case"touchmove":this.handleTouchMove(g);break;case"touchend":this.handleTouchEnd(g);break}}};e.SlideBar=f})(window,document,Math);