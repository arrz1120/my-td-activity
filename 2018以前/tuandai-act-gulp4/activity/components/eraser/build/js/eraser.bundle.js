!function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var i={};e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="./js/",e(e.s=0)}([function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(){var t=!0;return function(e,i,n){return function(){var o=arguments;t&&(e.apply(n,o),t=!1,setTimeout(function(){t=!0},i))}}}(),s=function(){function t(e,i){n(this,t),this.el="string"==typeof e?document.querySelector(e):e,this.opts=t.mergeOpts(i);var o=this.opts,r=o.dpr,s=o.width,l=o.height;this.ctx=this.el.getContext("2d"),this.el.style.width=s,this.el.style.height=l,this.elRect=this.el.getBoundingClientRect(),this.elW=this.elRect.width,this.elH=this.elRect.height,this.el.width=this.elW*r,this.el.height=this.elH*r,this.ctx.scale(r,r),this.init()}return o(t,[{key:"init",value:function(){this.completed=!1,this.drawCover()}},{key:"reset",value:function(){this.ctx.clearRect(0,0,this.elW,this.elH),this.ctx.globalCompositeOperation="source-over",this.el.removeEventListener("touchstart",this.onTouch.bind(this)),this.el.removeEventListener("touchmove",this.onTouch.bind(this)),this.init()}},{key:"drawCover",value:function(){var t=this,e=this.opts,i=e.cover,n=e.onInit,o=this.ctx;if(this.coverType=function(){return"#"===i.slice(0,1)||"rgb"===i.slice(0,3)?"color":"img"}(),"color"===this.coverType&&(o.fillStyle=i,o.fillRect(0,0,this.elW,this.elH),o.globalCompositeOperation="destination-out",this.el.addEventListener("touchstart",this.onTouch.bind(this)),this.el.addEventListener("touchmove",this.onTouch.bind(this)),n&&n.call(this)),"img"===this.coverType){var r=new Image;r.src=i,r.onload=function(){o.drawImage(r,0,0,t.elW,t.elH),o.globalCompositeOperation="destination-out",t.el.addEventListener("touchstart",t.onTouch.bind(t)),t.el.addEventListener("touchmove",t.onTouch.bind(t)),n&&n.call(t)},r.onerror=function(){throw new Error("加载图片失败")}}}},{key:"drawPoint",value:function(t,e){var i=this.ctx,n=this.opts,o=n.touchSize,s=n.ratio,l=n.onComplete,h=n.onErase;i.beginPath();var c=i.createRadialGradient(t,e,0,t,e,o);c.addColorStop(0,"rgba(0,0,0,0.4)"),c.addColorStop(1,"rgba(255, 255, 255, 0)"),i.fillStyle=c,i.arc(t,e,o,0,2*Math.PI,!0),i.fill(),r(this.getErasePercent,1e3,this)(),h&&h.call(this,this.currentRatio),this.currentRatio>s&&(this.completed=!0,l&&l.call(this))}},{key:"getErasePercent",value:function(){for(var t=this.ctx,e=t.getImageData(0,0,this.elW,this.elH).data,i=[],n=0,o=e.length;n<o;n+=800)e[n+3]<100&&i.push(1);return this.currentRatio=1*(i.length/(e.length/800)).toFixed(3),this.currentRatio}},{key:"onTouch",value:function(t){if(!this.completed){t.preventDefault(),t.stopPropagation();var e=this.elRect,i=t.touches[0].clientX-e.left,n=t.touches[0].clientY-e.top;this.drawPoint(i,n)}}}],[{key:"mergeOpts",value:function(t){var e={cover:"rgba(0,0,0,.9)",width:null,height:null,touchSize:25,ratio:.5,dpr:1,onInit:null,onErase:null,onComplete:null};for(var i in t)e[i]=t[i];return e}}]),t}();window.Eraser=s}]);