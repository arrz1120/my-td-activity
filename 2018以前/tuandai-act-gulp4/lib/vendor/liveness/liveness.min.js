!function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="javascripts/",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){(function(e){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(3),a=t(o);!function(t,n){"object"===i(e)&&"object"===i(e.exports)?e.exports=t.Liveness=t.document?n(t,!0):function(e){if(!e.document)throw new Error("Liveness requires a window with a document");return n(e)}:t.Liveness=n(t)}("undefined"!=typeof window?window:void 0,function(e,t){return a["default"]})}).call(t,n(2)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t,n){var i,o,s,l;if(l=/\[\]$/,t instanceof Array)for(o=0,s=t.length;o<s;o++)l.test(e)?n(e,t[o]):a(e+"["+("object"===r(t[o])?o:"")+"]",t[o],n);else if("object"==("undefined"==typeof t?"undefined":r(t)))for(i in t)a(e+"["+i+"]",t[i],n);else n(e,t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=n(4),u=i(l),c=n(6),d=n(7),f=window.alert,p=function(e){var t,n,i,o,s,r;if(n=[],s=/%20/g,i=function(e,t){t="function"==typeof t?t():null==t?"":t,n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)},e instanceof Array)for(o in e)i(o,e[o]);else for(t in e)a(t,e[t],i);return r=n.join("&").replace(s,"+")},h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.url){var t=new XMLHttpRequest;return t.open("POST",e.url,!0),t.onreadystatechange=function(){if(4===t.readyState)if(200===t.status)e.success&&e.success(JSON.parse(t.responseText));else{var n;try{n=JSON.parse(t.responseText)}catch(i){n=null}finally{e.error&&e.error(n)}}},t.onerror=function(t){e.error&&e.error(t)},"object"===r(e.data)&&e.data.constructor===Object?(t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(p(e.data))):t.send(e.data),t}},v=function(e){var t=new Promise(function(t,n){if(e.size>c.livenessLimit.size)return void n({errorCode:2});var i=document.createElement("video"),o=!1;i.preload="metadata",i.onloadedmetadata=function(){o=!0,(0,d.revokeObjectURL)(i.src),i.duration>c.livenessLimit.duration?n({errorCode:1}):t({file:e})},i.src=(0,d.createObjectURL)(e),setTimeout(function(){o||t({file:e})},2e3)});return t},m=function(){function e(t){if(o(this,e),this.options=t||{},!this.options||!this.options.onChecked)throw new Error("Please provide callback for check");if(!this.options||!c.livenessAssets[this.options.action])throw new Error("Please provide specific liveness action among nod, open mouth and yaw");this.config=new u["default"](t)}return s(e,[{key:"getAction",value:function(){this.action=c.livenessAssets[this.options.action]}},{key:"getModal",value:function(){var e=this,t=this.getMask();if(!this.modal){this.modal=document.createElement("div"),this.modal.className="modal liveness-modal",this.modal.innerHTML='<div class="modal-body">\n                                <div class="sample">\n                                  <div class="sample-inner">\n                                    <div class="gif-container"><img src="'+this.action.gif+'"></div>\n                                  </div>\n                                </div>\n                                <p>\n                                  录制不超过<em> '+c.livenessLimit.duration+"s </em>的视频<br>\n                                  拍摄视频时请<em>"+this.action.description+"</em>\n                                </p>\n                              </div>",t.appendChild(this.modal);var n=!!localStorage.getItem("viewed"),i=3,o=document.createElement("button");if(o.id="confirm",n)o.textContent="开始录制",o.classList.add("enabled");else{o.textContent="开始录制 ("+i+")";var a=setInterval(function(){i--,i>0?o.textContent="开始录制 ("+i+")":(o.textContent="开始录制",o.classList.add("enabled"),localStorage.getItem("viewed")||localStorage.setItem("viewed",!0),clearInterval(a))},1e3)}o.addEventListener("click",function(){(0===i||n)&&e.uploadInput.click()});var s=this.modal.querySelector(".modal-body");s.appendChild(o)}return this.clearUploadInput(),this.modal}},{key:"clearUploadInput",value:function(){if(this.modal){var e=this.modal.querySelector(".modal-body");this.uploadInput&&(e.removeChild(this.uploadInput),this.uploadInput=null),this.uploadInput=document.createElement("input"),this.uploadInput.className="upload-input",this.uploadInput.setAttribute("type","file"),this.uploadInput.setAttribute("accept","video/*"),this.uploadInput.setAttribute("capture",!0),this.uploadInput.addEventListener("change",this.handleUpload.bind(this)),e.appendChild(this.uploadInput)}}},{key:"getMask",value:function(){var e=this;return this.mask||(this.mask=document.createElement("div"),this.mask.className="liveness-modal-mask",this.mask.addEventListener("click",function(t){t.stopPropagation(),t.target===e.mask&&(e.xhr&&e.xhr.abort(),e.hackXhr&&e.hackXhr.abort(),e.mask.classList.remove("opened"))}),document.body.appendChild(this.mask)),this.mask}},{key:"handleUpload",value:function(e){var t=this,n=e.target.files[0];n&&(this.loading(),v(n).then(function(){var e=new FormData;e.append("motions",[t.action.key].join(" ")),e.append("liveness_data_file",n),t.xhr=h({url:t.config.livenessApi(),data:e,success:function(e){t.handleResult(e)},error:function(e){t.handleResult(e)}})},function(e){t.handleResult(e)}))}},{key:"handleResult",value:function(e){var t=this.options.onError||f;if(e&&e.errorCode)return 1===e.errorCode?t("视频时长不能超过"+c.livenessLimit.duration+"s"):2===e.errorCode&&t("视频大小不能超过"+c.livenessLimit.sizeText),void this.unloading();if(e){if("RPC_TIMEOUT"===e.status)t("请求超时，稍后请重试！");else if("OK"===e.status){var n=Object.assign({},e.result);if(n.feature_image_id)return n.feature_image_url=this.config.livenessShot(n.feature_image_id),void this.handleHack(n);t("上传的视频未检测出人脸")}}else t("请求服务器出错，请重试！");this.unloading()}},{key:"handleHack",value:function(e){var t=this,n=this.options.onChecked,i=Object.assign({},e);this.hackXhr=h({url:this.config.livenessHackApi(),data:{image_id:e.feature_image_id},success:function(e){"OK"===e.status?(i.hackPassed=e.score<=c.HACK_SCORE_MAX,i.hackScore=e.score,n(i),t.hide()):onError(c.hackErrorMap[e.status]),t.unloading()},error:function(e){onError("请求服务器出错，请重试！"),t.unloading()}},function(e){onError("请求服务器出错，请重试！"),t.unloading()})}},{key:"getLoader",value:function(){if(!this.loadModal){var e=this.getMask(),t=document.createElement("div");t.className="modal loading-modal",t.innerHTML='<div class="modal-body">\n                               <div class="gif-container"><img src="../../images/cloud.gif" alt="Loading"></div>\n                               <p>上传中...</p>\n                             </div>',e.appendChild(t),this.loadModal=t}return this.loadModal}},{key:"loading",value:function(){var e=this.getLoader();this.modal&&this.modal.classList.add("hide"),e.classList.remove("hide")}},{key:"unloading",value:function(e){var t=this.getModal(),n=this.getLoader();n.classList.add("hide"),this.clearUploadInput(),t.classList.remove("hide"),e&&this.hide()}},{key:"show",value:function(){this.getAction(),this.getModal();var e=this.getMask();return e.classList.add("opened"),e}},{key:"hide",value:function(){this.mask&&this.mask.classList.remove("opened")}}]),e}();t["default"]=m},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e){return e?l["default"].stg.cloud:l["default"].prod.cloud}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(5),l=i(r),u="/liveness/check_liveness",c="/liveness/liveness_image",d="/hackness/selfie_hack_detect",f=function(){function e(t){if(o(this,e),t.host)this.host=t.host,this.auth="";else{if(!t.apiId||!t.apiSecret)throw new Error("Please provide api server or api authenciation");this.host=a(t.debug),this.auth="?api_id="+t.apiId+"&api_secret="+t.apiSecret}}return s(e,[{key:"livenessApi",value:function(){return""+this.host+u+this.auth}},{key:"livenessShot",value:function(e){return""+this.host+c+"/"+e+this.auth}},{key:"livenessHackApi",value:function(){return""+this.host+d+this.auth}}]),e}();t["default"]=f},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="192.168.2.153",i="192.168.2.153:10006",o="shieldweb.linkface.cn",a="cloudapi.linkface.cn";t["default"]={stg:{domain:n,proxy:"http://"+n+":8090",cloud:"http://"+i},prod:{domain:o,proxy:"http://"+o+":8090",cloud:"http://"+a}}},function(e,t){"use strict";function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0});var i,o=t.livenessEnum={BLINK:0,MOUTH:1,YAW:2};t.HACK_SCORE_MAX=.98,t.livenessAssets=(i={},n(i,o.BLINK,{key:"BLINK",gif:"../../images/blink.gif",description:"眨眨眼睛"}),n(i,o.MOUTH,{key:"MOUTH",gif:"../../images/mouth.gif",description:"张一张嘴"}),n(i,o.YAW,{key:"YAW",gif:"../../images/yaw.gif",description:"摇一摇头"}),i),t.livenessLimit={duration:5,size:15728640,sizeText:"15M"},t.hackErrorMap={ENCODING_ERROR:"参数非UTF-8编码",DOWNLOAD_TIMEOUT:"网络地址图片获取超时",DOWNLOAD_ERROR:"网络地址图片获取失败",IMAGE_ID_NOT_EXIST:"图片不存在",IMAGE_FILE_SIZE_TOO_BIG:"图片体积过大",CORRUPT_IMAGE:"文件不是图片文件或已经损坏",INVALID_IMAGE_FORMAT_OR_SIZE:"图片大小或格式不符合要求",INVALID_ARGUMENT:"请求参数错误",NO_FACE_DETECTED:"上传的图片未检测出人脸",UNAUTHORIZED:"账号或密钥错误",KEY_EXPIRED:"账号过期",RATE_LIMIT_EXCEEDED:"调用频率超出限额",NO_PERMISSION:"无调用权限",NOT_FOUND:"请求路径错误",INTERNAL_ERROR:"服务器内部错误"},t.idNumberErrorMap={"Gongan status OK":"拿到公安后台预留照片","Gongan photo doesn’t exist":"姓名和身份证号匹配，公安照片不存在","Name and idcard number doesn’t match":"姓名与身份证号不匹配","Invalid idcard number":"非法身份证号码","Gongan service timeout":"公安接口获取超时","Gongan service is unavailable temporarily":"公安服务不可用","Network error":"网络错误","Unknown error":"未知错误"},t.identityErrorMap={ENCODING_ERROR:"参数非UTF-8编码",DOWNLOAD_TIMEOUT:"网络地址图片获取超时",DOWNLOAD_ERROR:"网络地址图片获取失败",IMAGE_ID_NOT_EXIST:"图片不存在",IMAGE_FILE_SIZE_TOO_BIG:"图片体积过大",NO_FACE_DETECTED:"上传的图片未检测出人脸",CORRUPT_IMAGE:"文件不是图片文件或已经损坏",INVALID_IMAGE_FORMAT_OR_SIZE:"图片大小或格式不符合要求",INVALID_ARGUMENT:"请求参数错误",UNAUTHORIZED:"账号或密钥错误",KEY_EXPIRED:"账号过期",RATE_LIMIT_EXCEEDED:"调用频率超出限额",NO_PERMISSION:"无调用权限",NOT_FOUND:"请求路径错误",INTERNAL_ERROR:"服务器内部错误"},t.IDENTITY_BOUND=.7},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=window.URL||window.webkitURL;t.createObjectURL=window.createObjectURL||n.createObjectURL,t.revokeObjectURL=window.revokeObjectURL||n.revokeObjectURL}]);